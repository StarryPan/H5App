{"ast":null,"code":"import \"antd-mobile/es/list-view/style\";\nimport _ListView from \"antd-mobile/es/list-view\";\nimport \"antd-mobile/es/activity-indicator/style\";\nimport _ActivityIndicator from \"antd-mobile/es/activity-indicator\";\nimport \"antd-mobile/es/modal/style\";\nimport _Modal from \"antd-mobile/es/modal\";\nimport \"antd-mobile/es/list/style\";\nimport _List from \"antd-mobile/es/list\";\nvar _jsxFileName = \"/usr/local/var/www/orangeweb/src/pages/walletDetailNew/index.js\";\n/**\n * @file 钱包详情页面\n */\nimport React from 'react';\nimport Empty from '../../components/Empty';\nimport { getFetch } from '../../service/request';\nimport API from '../../service/api';\nimport './style.less';\nimport GImg from '../../images/my/gicon.png';\nimport { getAccountInfo } from \"../../common/bridge\";\nconst Item = _List.Item;\nconst Brief = Item.Brief;\nexport default class WalletDetail extends React.Component {\n  constructor(props) {\n    super(props);\n    this.alert = message => {\n      _Modal.alert('', message, [{\n        text: '确定'\n      }]);\n    };\n    this.renderFooter = () => {\n      return this.state.isMoreLoading ? /*#__PURE__*/React.createElement(\"div\", {\n        className: \"tc\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          display: 'inline-block'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_ActivityIndicator, {\n        className: \"tc\",\n        text: \"Loading...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 17\n        }\n      }))) : /*#__PURE__*/React.createElement(\"div\", {\n        className: \"tc\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 10\n        }\n      }, \"\\u6CA1\\u6709\\u66F4\\u591A\\u660E\\u7EC6\\u4E86\");\n    };\n    this.onEndReached = () => {\n      if (this.state.offset === -1) return;\n      this.setState({\n        isMoreLoading: true\n      }, () => {\n        this.getDetail();\n      });\n    };\n    const dataSource = new _ListView.DataSource({\n      rowHasChanged: (row1, row2) => row1._id !== row2._id\n    });\n    this.state = {\n      loading: true,\n      isMoreLoading: false,\n      dataSource,\n      dataList: [],\n      tabType: 'PAY',\n      currencyType: \"CASH\",\n      summer: true,\n      offset: 0,\n      overall: null\n    };\n  }\n  async componentDidMount() {\n    var info = await getAccountInfo();\n    if (info.summer == 0) {\n      this.setState({\n        summer: parseInt(info.summer)\n      }, () => {\n        this.getDetail();\n      });\n    } else {\n      this.getDetail();\n    }\n  }\n  getDetail() {\n    const {\n      offset,\n      tabType,\n      dataList,\n      currencyType\n    } = this.state;\n    getFetch(API.walletDetailNew, {\n      offset: offset,\n      type: tabType,\n      currency_type: currencyType\n    }).then(data => {\n      data.result.result.forEach((item, index) => {\n        item._id = offset + index;\n      });\n      this.setState({\n        loading: false,\n        isMoreLoading: false,\n        overall: data.result.overall,\n        dataList: dataList.concat(data.result.result || []),\n        offset: data.offset\n      });\n    }).catch(err => {\n      this.setState({\n        loading: false,\n        isMoreLoading: false\n      });\n      this.alert(err.message);\n    });\n  }\n  renderRow(item, sectionID, rowID) {\n    return /*#__PURE__*/React.createElement(Item, {\n      key: item._id,\n      extra: /*#__PURE__*/React.createElement(\"div\", {\n        className: \"r-view\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 9\n        }\n      }, \"+\", item.num, item.unit === 'CASH' ? /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }\n      }, \"\\u91D1\\u5E01\") : item.unit === 'GIFT' ? /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 13\n        }\n      }, \"\\u94BB\\u77F3\") : /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 13\n        }\n      }, \"\\u79EF\\u5206\")),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 7\n      }\n    }, item.desc, /*#__PURE__*/React.createElement(Brief, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    }, item.ctime));\n  }\n  changeCurrencyType(type) {\n    this.setState({\n      currencyType: type,\n      dataList: [],\n      loading: true\n    }, () => {\n      this.getDetail();\n    });\n  }\n  render() {\n    const {\n      loading,\n      dataList,\n      tabType,\n      summer,\n      overall,\n      currencyType\n    } = this.state;\n    console.log('dataList', dataList);\n    const dataSource = this.state.dataSource.cloneWithRows(dataList);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 7\n      }\n    }, !loading && (dataList.length ? /*#__PURE__*/React.createElement(_ListView, {\n      className: tabType === \"PAY\" ? \"wallet-list pay\" : \"wallet-list\",\n      initialListSize: 20,\n      dataSource: dataSource,\n      renderFooter: this.renderFooter,\n      renderRow: this.renderRow,\n      pageSize: 10,\n      useBodyScroll: true,\n      onScroll: () => {\n        console.log('scroll');\n      },\n      scrollRenderAheadDistance: 300,\n      onEndReached: this.onEndReached,\n      onEndReachedThreshold: 10,\n      contentContainerStyle: {\n        backgroundColor: '#FFF'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 13\n      }\n    }) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"empty-view\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }\n    }, \"\\u6682\\u65E0\\u660E\\u7EC6\")), /*#__PURE__*/React.createElement(_ActivityIndicator, {\n      toast: true,\n      text: \"Loading...\",\n      animating: loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }\n    }));\n  }\n}","map":{"version":3,"names":["React","Empty","getFetch","API","GImg","getAccountInfo","Item","Brief","WalletDetail","Component","constructor","props","alert","message","text","renderFooter","state","isMoreLoading","display","onEndReached","offset","setState","getDetail","dataSource","DataSource","rowHasChanged","row1","row2","_id","loading","dataList","tabType","currencyType","summer","overall","componentDidMount","info","parseInt","walletDetailNew","type","currency_type","then","data","result","forEach","item","index","concat","catch","err","renderRow","sectionID","rowID","num","unit","desc","ctime","changeCurrencyType","render","console","log","cloneWithRows","length","backgroundColor"],"sources":["/usr/local/var/www/orangeweb/src/pages/walletDetailNew/index.js"],"sourcesContent":["/**\n * @file 钱包详情页面\n */\nimport React from 'react';\nimport {Flex, List, WingBlank, ActivityIndicator, Modal, ListView } from 'antd-mobile';\nimport Empty from '../../components/Empty'\nimport { getFetch } from '../../service/request'\nimport API from '../../service/api'\nimport './style.less';\n\nimport GImg from '../../images/my/gicon.png'\n\nimport {getAccountInfo} from \"../../common/bridge\";\n\nconst Item = List.Item\nconst Brief = Item.Brief\n\nexport default class WalletDetail extends React.Component{\n  constructor(props){\n    super(props);\n    const dataSource = new ListView.DataSource({\n      rowHasChanged: (row1, row2) => row1._id !== row2._id,\n  });\n    this.state = {\n      loading: true,\n      isMoreLoading: false,\n      dataSource,\n      dataList: [],\n      tabType: 'PAY',\n      currencyType: \"CASH\",\n      summer:true,\n      offset: 0,\n      overall: null,\n    }\n  }\n  async componentDidMount() {\n    var info = await getAccountInfo()\n    if (info.summer==0) {\n      this.setState({\n        summer: parseInt(info.summer),\n      }, ()=> {\n        this.getDetail()\n      })\n    } else {\n      this.getDetail()\n    }\n  }\n  getDetail() {\n    const { offset, tabType, dataList, currencyType } = this.state\n    getFetch(API.walletDetailNew, {\n      offset: offset,\n      type: tabType,\n      currency_type: currencyType,\n    }).then((data)=>{\n      data.result.result.forEach((item, index) => {\n        item._id = offset + index\n      })\n      this.setState({\n        loading: false,\n        isMoreLoading: false,\n        overall: data.result.overall,\n        dataList: dataList.concat(data.result.result || []),\n        offset: data.offset,\n      })\n    }).catch((err) => {\n      this.setState({\n        loading: false,\n        isMoreLoading: false,\n      })\n      this.alert(err.message)\n    })\n  }\n  alert = (message)=>{\n    Modal.alert('', message,[{\n      text: '确定'\n    }])\n  }\n  renderRow(item, sectionID, rowID){\n    return (\n      <Item\n        key={item._id}\n        extra = {\n        <div className=\"r-view\">\n          +{item.num}\n          {item.unit === 'CASH' ? (\n            <span>金币</span>\n          ) : item.unit === 'GIFT' ? (\n            <span>钻石</span>\n          ) : (\n            <span>积分</span>\n          )}\n        </div>\n      }>\n        {item.desc}\n        <Brief>{item.ctime}</Brief>\n      </Item>\n    )\n  }\n  renderFooter = ()=>{\n    return this.state.isMoreLoading ? (\n        <div className=\"tc\">\n            <div style={{display: 'inline-block'}}>\n                <ActivityIndicator\n                    className='tc'\n                    text=\"Loading...\"\n                />\n            </div>\n        </div>\n    ) : (<div className=\"tc\">没有更多明细了</div>)\n  }\n  onEndReached = ()=>{\n    if (this.state.offset === -1) return\n    this.setState({\n      isMoreLoading: true\n    }, ()=>{\n      this.getDetail()\n    })\n  }\n  changeCurrencyType(type) {\n    this.setState({\n      currencyType: type,\n      dataList: [],\n      loading: true\n    }, ()=> {\n      this.getDetail()\n    })\n  }\n\trender(){\n    const { loading, dataList, tabType, summer, overall, currencyType  } = this.state\n    console.log('dataList', dataList)\n    const dataSource = this.state.dataSource.cloneWithRows(dataList);\n\n\t\treturn(\n      <div>\n        { !loading && (\n          dataList.length ? (\n            <ListView\n              className={tabType === \"PAY\" ? \"wallet-list pay\" : \"wallet-list\"}\n              initialListSize = {20}\n              dataSource={dataSource}\n              renderFooter={this.renderFooter}\n              renderRow={this.renderRow}\n              pageSize = {10}\n              useBodyScroll\n              onScroll={() => { console.log('scroll'); }}\n              scrollRenderAheadDistance={300}\n              onEndReached={this.onEndReached}\n              onEndReachedThreshold={10}\n              contentContainerStyle = {{backgroundColor: '#FFF'}}\n          />\n          ) : (\n            <div className=\"empty-view\">\n              暂无明细\n            </div>\n          ))\n        }\n        <ActivityIndicator\n          toast\n          text=\"Loading...\"\n          animating={loading}\n        />\n      </div>\n\t\t);\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}