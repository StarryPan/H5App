{"ast":null,"code":"import \"antd-mobile/es/toast/style\";\nimport _Toast from \"antd-mobile/es/toast\";\nimport \"antd-mobile/es/modal/style\";\nimport _Modal from \"antd-mobile/es/modal\";\nvar _jsxFileName = \"/usr/local/var/www/orangeweb/src/components/LoginView/index.js\";\nimport React, { Component } from 'react';\nimport './style.less';\nimport API from '../../service/api';\nimport { postFetch } from '../../service/request';\nimport Util from '../../common/util';\nclass LoginView extends Component {\n  constructor(props) {\n    super(props);\n    this.alert = message => {\n      _Modal.alert('', message, [{\n        text: '确定'\n      }]);\n    };\n    this.state = {\n      showModal: props.visable,\n      leaving: false,\n      countdown: 0\n    };\n  }\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    console.log('getDerivedStateFromProps', nextProps);\n    if (nextProps.visable !== this.state.showModal) {\n      this.setState({\n        showModal: nextProps.visable\n      });\n    }\n  }\n  closeAction() {\n    this.setState({\n      leaving: true\n    }, () => {\n      setTimeout(() => {\n        this.props.onClose && this.props.onClose();\n        this.setState({\n          leaving: false,\n          showModal: false\n        });\n      }, 250);\n    });\n  }\n  async sendSms() {\n    const phone = this.refs.phone.value;\n    if (phone.length !== 11) {\n      this.alert('请输入正确的手机号');\n      return;\n    }\n    try {\n      const sendRes = await postFetch(API.sendSms, {\n        phone,\n        phoneCheckCodeType: 'LOGIN'\n      });\n      this.setState({\n        countdown: 59\n      });\n      this.handle = setInterval(() => {\n        if (this.state.countdown < 1) {\n          clearTimeout(this.handle);\n        }\n        this.setState({\n          countdown: this.state.countdown - 1\n        });\n      }, 1000);\n    } catch (err) {\n      this.alert(err.message);\n    }\n  }\n  login() {\n    const phone = this.refs.phone.value;\n    const code = this.refs.code.value;\n    if (phone.length !== 11) {\n      this.alert('请输入正确的手机号');\n      return;\n    }\n    if (!code.length) {\n      this.alert('验证码不能为空');\n      return;\n    }\n    postFetch(API.checkLogin, {\n      phone,\n      checkcode: code\n    }).then(data => {\n      Util.setLoginCookie(data);\n      this.setState({\n        showModal: false\n      });\n      _Toast.show(\"登录成功\");\n      this.props.loginSuccess && this.props.loginSuccess();\n    }).catch(err => {\n      this.alert(err.message);\n    });\n  }\n  render() {\n    const {\n      showModal,\n      leaving,\n      countdown\n    } = this.state;\n    if (!showModal) {\n      return null;\n    }\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"t-dialog\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"t-dialog__content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: 'login-modal' + (leaving ? ' leave' : ''),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-top\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 15\n      }\n    }, \" \\u767B\\u5F55 \"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"login_modal_container\",\n      className: \"login-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"login-input\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      ref: \"phone\",\n      type: \"text\",\n      placeholder: \"\\u8F93\\u5165\\u624B\\u673A\\u53F7\",\n      className: \"input-txt\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      ref: \"code\",\n      type: \"text\",\n      placeholder: \"\\u9A8C\\u8BC1\\u7801\",\n      className: \"input-txt verifycode\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 21\n      }\n    }), countdown > 0 ? /*#__PURE__*/React.createElement(\"span\", {\n      className: \"Verification\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 23\n      }\n    }, countdown, \"s\") : /*#__PURE__*/React.createElement(\"span\", {\n      onClick: this.sendSms.bind(this),\n      className: \"Verification\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 23\n      }\n    }, \"\\u83B7\\u53D6\\u9A8C\\u8BC1\\u7801\")), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"Receive\",\n      onClick: this.login.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 21\n      }\n    }, \"\\u767B\\u5F55\")))), /*#__PURE__*/React.createElement(\"div\", {\n      onClick: this.closeAction.bind(this),\n      className: \"login-close\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 15\n      }\n    }))));\n  }\n}\nexport default LoginView;","map":{"version":3,"names":["React","Component","API","postFetch","Util","LoginView","constructor","props","alert","message","text","state","showModal","visable","leaving","countdown","UNSAFE_componentWillReceiveProps","nextProps","console","log","setState","closeAction","setTimeout","onClose","sendSms","phone","refs","value","length","sendRes","phoneCheckCodeType","handle","setInterval","clearTimeout","err","login","code","checkLogin","checkcode","then","data","setLoginCookie","show","loginSuccess","catch","render","bind"],"sources":["/usr/local/var/www/orangeweb/src/components/LoginView/index.js"],"sourcesContent":["import React, {Component} from 'react';\nimport { Modal, Toast, Tosat } from 'antd-mobile'\nimport  './style.less';\nimport API from '../../service/api'\nimport { postFetch } from '../../service/request'\nimport Util from '../../common/util';\nclass LoginView extends Component {\n    constructor(props) {\n      super(props);\n      this.state = {\n        showModal: props.visable,\n        leaving: false,\n        countdown: 0,\n      }\n    }\n    UNSAFE_componentWillReceiveProps(nextProps) {\n      console.log('getDerivedStateFromProps', nextProps)\n      if(nextProps.visable !== this.state.showModal) {\n        this.setState({\n          showModal: nextProps.visable\n        })\n      }\n    }\n    closeAction() {\n      this.setState({\n        leaving: true,\n      }, ()=> {\n        setTimeout(()=>{\n          this.props.onClose && this.props.onClose()\n          this.setState({\n            leaving: false,\n            showModal: false,\n          })\n        }, 250)\n      })\n    }\n    async sendSms() {\n      const phone = this.refs.phone.value\n      if(phone.length !== 11) {\n        this.alert('请输入正确的手机号')\n        return\n      }\n      try {\n        const sendRes = await postFetch(API.sendSms, {\n          phone,\n          phoneCheckCodeType: 'LOGIN',\n        })\n        this.setState({\n          countdown: 59,\n        })\n        this.handle = setInterval(()=> {\n          if (this.state.countdown < 1) {\n            clearTimeout(this.handle)\n          }\n          this.setState({\n            countdown: this.state.countdown - 1,\n          })\n        }, 1000)\n      } catch(err) {\n        this.alert(err.message)\n      }\n      \n    }\n    login(){\n      const phone = this.refs.phone.value\n      const code = this.refs.code.value\n      if(phone.length !== 11) {\n        this.alert('请输入正确的手机号')\n        return\n      }\n      if(!code.length) {\n        this.alert('验证码不能为空')\n        return\n      }\n      postFetch(API.checkLogin, {\n        phone,\n        checkcode: code,\n      }).then((data)=>{\n        Util.setLoginCookie(data)\n        this.setState({\n          showModal: false,\n        })\n        Toast.show(\"登录成功\")\n        this.props.loginSuccess && this.props.loginSuccess()\n      }).catch((err)=>{\n        this.alert(err.message)\n      })\n    }\n    alert = (message)=>{\n      Modal.alert('', message,[{\n        text: '确定'\n      }])\n    }\n    render() {\n      const { showModal, leaving, countdown } = this.state\n      if (!showModal) {\n        return null\n      }\n      return (\n        <div className=\"t-dialog\">\n          <div className=\"t-dialog__content\">\n            <div className={'login-modal' + (leaving ? ' leave' : '')}>\n              <div className=\"login-top\"> 登录 </div>\n              <div id=\"login_modal_container\" className=\"login-wrap\">\n                <ul className=\"login-input\">\n                  <li>\n                    <input ref='phone' type=\"text\" placeholder=\"输入手机号\" className=\"input-txt\" />\n                  </li>\n                  <li>\n                    <input ref='code' type=\"text\" placeholder=\"验证码\" className=\"input-txt verifycode\"/>\n                    {countdown > 0 ? (\n                      <span className=\"Verification\">{countdown}s</span>\n                    ) : (\n                      <span onClick={this.sendSms.bind(this)} className=\"Verification\">获取验证码</span>\n                    )}\n                  </li>\n                  <li>\n                    <button className=\"Receive\" onClick={this.login.bind(this)}>登录</button>\n                  </li>\n                </ul>\n              </div>\n              <div onClick={this.closeAction.bind(this)} className=\"login-close\"></div>\n            </div>\n          </div>\n        </div>\n      )\n\t}\n}\n\nexport default LoginView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}